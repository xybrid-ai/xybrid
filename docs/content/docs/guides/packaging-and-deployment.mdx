---
title: Packaging & Deployment
description: Bundle creation and registry publishing
---

Package models into distributable `.xyb` bundles and publish them to registries.

## Overview

The deployment workflow:

```
Model Files → Pack → .xyb Bundle → Deploy → Registry
```

## Phase 4: Package Models

### Prepare Model Directory

Create a directory with your model artifacts:

```
models/my-model/
├── model_metadata.json    # Required: execution config
├── model.onnx             # Model weights
├── vocab.json             # Vocabulary (if needed)
└── tokens.txt             # Token list (if needed)
```

### Create model_metadata.json

Every model needs execution configuration:

```json
{
  "model_id": "my-model",
  "version": "1.0",
  "description": "My custom model",

  "execution_template": {
    "type": "SimpleMode",
    "model_file": "model.onnx"
  },

  "preprocessing": [
    { "type": "AudioDecode", "sample_rate": 16000, "channels": 1 }
  ],

  "postprocessing": [
    { "type": "CTCDecode", "vocab_file": "vocab.json", "blank_index": 0 }
  ],

  "files": ["model.onnx", "vocab.json"]
}
```

### Pack the Bundle

```bash
xybrid pack my-model --version 1.0.0 --target macos-arm64
```

This creates `my-model@1.0.0.xyb` containing:

```
my-model@1.0.0.xyb/
├── manifest.json          # Bundle metadata + hash
├── model_metadata.json    # Execution config
├── model.onnx             # Model weights
└── vocab.json             # Supporting files
```

### Platform Variants

Create bundles for each target platform:

```bash
# Apple Silicon Mac
xybrid pack whisper-tiny --version 1.0.0 --target macos-arm64

# iOS
xybrid pack whisper-tiny --version 1.0.0 --target ios-arm64

# Android
xybrid pack whisper-tiny --version 1.0.0 --target android-arm64
```

## Phase 5: Deploy to Registry

### Local Registry

Deploy to the local cache:

```bash
xybrid deploy my-model@1.0.0.xyb --registry local
```

Bundles are stored at:

```
~/.xybrid/registry/
├── index.json                    # Bundle index
└── my-model/
    └── 1.0.0/
        └── macos-arm64/
            └── my-model.xyb
```

### Remote Registry

Deploy to an HTTP registry:

```bash
xybrid deploy my-model@1.0.0.xyb --registry remote -p https://registry.xybrid.dev
```

### Verify Deployment

Check the registry index:

```bash
cat ~/.xybrid/registry/index.json
```

```json
{
  "my-model/1.0.0/macos-arm64": {
    "model_id": "my-model",
    "version": "1.0.0",
    "target": "macos-arm64",
    "size_bytes": 12345678,
    "path": "~/.xybrid/registry/my-model/1.0.0/macos-arm64/my-model.xyb"
  }
}
```

## Bundle Types

### ASR Bundle (Wav2Vec2)

```json
{
  "model_id": "wav2vec2-base-960h",
  "version": "1.0",
  "execution_template": {
    "type": "SimpleMode",
    "model_file": "model.onnx"
  },
  "preprocessing": [
    { "type": "AudioDecode", "sample_rate": 16000, "channels": 1 }
  ],
  "postprocessing": [
    { "type": "CTCDecode", "vocab_file": "vocab.json", "blank_index": 0 }
  ]
}
```

### ASR Bundle (Whisper/Candle)

```json
{
  "model_id": "whisper-tiny",
  "version": "1.0",
  "execution_template": {
    "type": "CandleModel",
    "model_type": "WhisperTiny"
  },
  "preprocessing": [
    { "type": "AudioDecode", "sample_rate": 16000, "channels": 1 }
  ],
  "postprocessing": []
}
```

### TTS Bundle (Kokoro)

```json
{
  "model_id": "kokoro-82m",
  "version": "0.1",
  "execution_template": {
    "type": "SimpleMode",
    "model_file": "model.onnx"
  },
  "preprocessing": [
    {
      "type": "Phonemize",
      "tokens_file": "tokens.txt",
      "backend": "EspeakNG"
    }
  ],
  "postprocessing": [
    {
      "type": "TTSAudioEncode",
      "sample_rate": 24000,
      "apply_postprocessing": true
    }
  ]
}
```

## Using justfile Commands

The project includes convenient commands:

```bash
# Create all bundles
just registry::create

# Create specific bundle
just registry::create-bundle whisper-tiny

# Check cache status
just registry::cache-status

# Start local registry server
just registry::serve-local

# Clean registry
just registry::clean
```

## Registry Server

Serve bundles over HTTP for distributed access:

```bash
just registry::serve-local
```

This serves `~/.xybrid/registry/` on port 8080. Clients can fetch bundles:

```bash
curl http://localhost:8080/bundles/whisper-tiny/1.0/macos-arm64/whisper-tiny.xyb
```

## Next Steps

- [Observability](/docs/guides/observability) - Monitor deployed pipelines
- [Registry](/docs/overview/registry) - Registry architecture details
- [Bundles](/docs/overview/bundles) - Bundle format specification
